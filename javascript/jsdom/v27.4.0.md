# Security Audit: jsdom v27.4.0

**Package:** jsdom
**Version:** 27.4.0
**Audit Date:** 2026-02-01
**Category:** DOM Implementation / Testing Utility

## Package Information

| Field | Value |
|-------|-------|
| Name | jsdom |
| Version | 27.4.0 |
| License | MIT |
| Repository | https://github.com/jsdom/jsdom |
| Weekly Downloads | ~17.5M |

## Description

jsdom is a JavaScript implementation of many web standards, notably the WHATWG
DOM and HTML Standards, for use with Node.js. It provides a simulated browser
environment, allowing developers to test web applications, parse HTML, and
manipulate the DOM without a real browser.

Common use cases include:

- Unit testing React/Vue/Angular components
- Server-side rendering
- Web scraping and HTML parsing
- Testing browser APIs in Node.js

## Security Assessment

**Overall Status:** SECURE

The latest version 27.4.0 has no known direct vulnerabilities. The only
historical CVE (CVE-2021-20066) was withdrawn as it requires explicit unsafe
configuration by the user.

## Historical Vulnerabilities

### CVE-2021-20066: Local Resource Loading (WITHDRAWN)

| Field | Value |
|-------|-------|
| CVE ID | CVE-2021-20066 |
| GHSA ID | GHSA-f4c9-cqv8-9v98 |
| Original Severity | Medium (5.6/10) |
| Current Status | **WITHDRAWN** |
| CWE | CWE-1220 (Insufficient Granularity of Access Control) |
| Published | 2021-02-16 |
| Withdrawn | 2024-07-19 |

**Description:**

jsdom allows the loading of local resources when the `resources: "usable"`
parameter is enabled. Modern browser security best practices dictate that
loading local resources should be disallowed by default.

When creating a JSDOM object with `resources: "usable"`, the library allows
loading both external AND local filesystem resources via `file://` URLs.
Combined with `runScripts: "dangerously"`, this could theoretically allow
exfiltration of sensitive local files.

**Why It Was Withdrawn:**

The advisory was withdrawn because exploitation requires explicit opt-in by the
developer:

1. Developer must set `resources: "usable"` (not default)
2. Developer must set `runScripts: "dangerously"` (not default)
3. Developer must process untrusted HTML content

The jsdom maintainers argued that when developers explicitly opt into these
dangerous configurations, they assume responsibility for the security
implications. From the maintainer:

> "When you explicitly opt in to loading of data via resources: 'usable', you
> are opting in to exfiltration. And when you explicitly opt in to script
> execution with runScripts: 'dangerously', you are opting in to running
> arbitrary Node.js code on your machine."

**Proof of Concept:**

```javascript
const { JSDOM } = require('jsdom');

// This configuration is explicitly dangerous
const source = '<iframe src="file:///etc/passwd" />';
const dom = new JSDOM(source, {
  url: 'http://localhost:8080/',
  resources: 'usable',         // Opt-in to resource loading
  runScripts: 'dangerously'    // Opt-in to script execution
});
```

**Mitigation:**

- Do NOT use `resources: "usable"` with untrusted content
- Do NOT use `runScripts: "dangerously"` with untrusted content
- Process only trusted inputs
- Use the default safe configuration

**References:**

- https://github.com/advisories/GHSA-f4c9-cqv8-9v98
- https://www.tenable.com/security/research/tra-2021-05
- https://github.com/jsdom/jsdom/issues/3124
- https://nvd.nist.gov/vuln/detail/CVE-2021-20066

## Security Considerations for DOM Implementations

jsdom simulates a browser environment, which introduces inherent security
considerations:

### XSS Concerns

jsdom itself does not have XSS vulnerabilities because it runs in Node.js, not
in a browser. However, when using jsdom:

1. **Script Execution:** By default, jsdom does NOT execute scripts. The
   `runScripts` option must be explicitly set to `"dangerously"` to enable
   script execution.

2. **Content Isolation:** jsdom instances are isolated Node.js environments.
   Scripts running in jsdom cannot access the parent Node.js process unless
   explicitly configured.

3. **No Real Browser Context:** Unlike real browsers, jsdom has no same-origin
   policy enforcement, cookie jar isolation, or other browser security features
   unless explicitly implemented.

### Safe Usage Patterns

```javascript
// SAFE: Default configuration (no script execution)
const dom = new JSDOM('<p>Hello</p>');

// SAFE: Parsing HTML without scripts
const dom = new JSDOM(untrustedHTML);
const text = dom.window.document.body.textContent;

// DANGEROUS: Only use with trusted content
const dom = new JSDOM(trustedHTML, {
  runScripts: 'dangerously',
  resources: 'usable'
});
```

## Recent Security-Related Changes

### v27.4.0

- Fixed memory leak when Range objects were used and referenced elements
  deleted (prevents potential DoS)
- Improved HTML byte decoding via `@exodus/bytes` for more correct handling
- XML decoding now preferentially uses UTF-8 encoding

### v27.0.0

- Upgraded minimum `tough-cookie` version to address security advisory in that
  dependency
- Improved secure context detection for localhost URLs

## Dependency Security

jsdom has several dependencies that have had their own security advisories.
Notable dependencies include:

- `tough-cookie` - Cookie handling (has had historical CVEs)
- `whatwg-url` - URL parsing
- `parse5` - HTML parsing
- `cssstyle` - CSS parsing

Keep jsdom updated to ensure transitive dependency security fixes are applied.

## Recommendations

1. **Use version 27.4.0 or later** - Current version with all security updates
2. **Never use dangerous options with untrusted input:**
   - Avoid `runScripts: "dangerously"` with user-provided HTML
   - Avoid `resources: "usable"` with user-provided HTML
3. **For testing only** - jsdom is designed for testing, not production HTML
   sanitization
4. **Use DOMPurify for sanitization** - If you need to sanitize HTML, use a
   dedicated library like DOMPurify before passing to jsdom

## Version Matrix

| Version | CVE-2021-20066 | Status |
|---------|----------------|--------|
| 27.x | N/A (withdrawn) | Safe |
| 16.5.0+ | N/A (withdrawn) | Safe |
| <= 16.4.0 | Affected (opt-in) | Upgrade |

Note: CVE-2021-20066 was withdrawn and is not considered a vulnerability as it
requires explicit unsafe configuration.

## Sources

- [Snyk jsdom vulnerabilities](https://security.snyk.io/package/npm/jsdom)
- [GitHub Advisory GHSA-f4c9-cqv8-9v98 (Withdrawn)](https://github.com/advisories/GHSA-f4c9-cqv8-9v98)
- [Tenable Research TRA-2021-05](https://www.tenable.com/security/research/tra-2021-05)
- [GitHub jsdom Issue #3124](https://github.com/jsdom/jsdom/issues/3124)
- [NVD CVE-2021-20066](https://nvd.nist.gov/vuln/detail/CVE-2021-20066)
- [jsdom Changelog](https://github.com/jsdom/jsdom/blob/main/Changelog.md)
- [npm registry](https://registry.npmjs.org/jsdom)
