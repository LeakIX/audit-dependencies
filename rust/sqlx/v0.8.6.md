# Security Audit: sqlx v0.8.6

**Audit Date**: 2026-02-01
**Auditor**: Claude (AI-assisted)
**Risk Level**: LOW

## Summary

SQLx is a popular async SQL toolkit for Rust with compile-time query checking.
With over 68 million downloads, it supports PostgreSQL, MySQL, and SQLite. One
security advisory (RUSTSEC-2024-0363) was disclosed in August 2024 involving
protocol-level SQL injection via truncating casts, but this was patched in
version 0.8.1. Version 0.8.6 includes all security fixes and is safe to use.

## Package Identity

| Field        | Value                                   |
| ------------ | --------------------------------------- |
| Registry     | https://crates.io/crates/sqlx           |
| Repository   | https://github.com/launchbadge/sqlx     |
| Documentation| https://docs.rs/sqlx                    |
| License      | MIT OR Apache-2.0                       |
| Maintainers  | Austin Bonander (@abonander)            |
| Last Release | 2025-05-19 (v0.8.6)                     |
| Downloads    | 68,500,000 total / 14,400,000 recent    |
| Created      | 2019-06-06                              |
| Versions     | 58 releases                             |

## Vulnerabilities

### Known CVEs

| CVE ID | RustSec ID        | Severity | Status  | Fixed In  |
| ------ | ----------------- | -------- | ------- | --------- |
| N/A    | RUSTSEC-2024-0363 | Medium   | PATCHED | >= 0.8.1  |

### Security Advisories

#### RUSTSEC-2024-0363 - Binary Protocol Misinterpretation (Truncating Casts)

- **Type**: Protocol-level SQL injection
- **Date**: 2024-08-16
- **Affected**: <= 0.8.0
- **Patched**: >= 0.8.1
- **Description**: Truncating casts in protocol encoding cause the length prefix
  to overflow when encoding values larger than 4GiB. This allows servers to
  misinterpret subsequent data as protocol commands, enabling SQL injection at
  the protocol level.
- **Demonstrated**: Yes - proof of concept presented at DEF CON 32
- **Impact by Database**:
  - **PostgreSQL**: HIGH - Exploitable with demonstrated PoC
  - **MySQL**: LOW - Not believed to be exploitable
  - **SQLite**: LOW - Not believed to be exploitable
- **Status**: PATCHED in 0.8.6

### Mitigation (for older versions)

- Reject any input over 4 GiB or input that could encode to a string > 4 GiB
- Implement request body size limits in web application middleware
- Use `Encode::size_hint()` method for sanity checks on encoded sizes
- Avoid dynamically built queries that could push message size over 4 GiB

## Supply Chain Analysis

- **Build Process**: Pure Rust crate with proc-macro companion (`sqlx-macros`)
- **Binary Artifacts**: None - source-only distribution
- **Reproducible Builds**: Yes - standard Cargo build process
- **Code Signing**: Crates.io cryptographic verification
- **Provenance**: LaunchBadge organization (commercial backing)
- **Unsafe Code**: Uses `#![forbid(unsafe_code)]` EXCEPT when SQLite feature is
  enabled (requires FFI via `libsqlite3-sys`)

## Dependency Tree

### Sub-Crates

SQLx is a workspace with multiple internal crates:

| Crate          | Purpose                          |
| -------------- | -------------------------------- |
| sqlx-core      | Core abstractions and traits     |
| sqlx-macros    | Compile-time query checking      |
| sqlx-postgres  | PostgreSQL driver                |
| sqlx-mysql     | MySQL/MariaDB driver             |
| sqlx-sqlite    | SQLite driver                    |

### Key External Dependencies

| Dependency       | Purpose                          | Notes                |
| ---------------- | -------------------------------- | -------------------- |
| tokio            | Async runtime                    | Audited (approved)   |
| futures-*        | Async utilities                  | Widely used          |
| sha2, hmac       | Cryptographic operations         | Well audited         |
| libsqlite3-sys   | SQLite FFI bindings              | SQLite feature only  |
| rustls/native-tls| TLS support                      | Optional features    |
| serde            | Serialization                    | Audited (approved)   |

### Notable Observations

- Complex dependency tree due to multiple database backend support
- Compile-time query checking requires proc-macro crate
- Platform-specific TLS backends (rustls vs native-tls)
- SQLite requires C library bindings (unsafe code path)

## Maintenance Health

| Metric          | Status                           |
| --------------- | -------------------------------- |
| Repository      | Active                           |
| Last release    | 2025-05-19 (v0.8.6)              |
| Open issues     | 666                              |
| Stars           | 16,500                           |
| Forks           | 1,500                            |
| Age             | 6+ years (since 2019)            |
| CI/CD           | Yes (GitHub Actions)             |
| Security Policy | Yes                              |
| Funding         | LaunchBadge (commercial)         |

## Recent Security-Related Changes

### Version 0.9.0-alpha.1 (Pre-release)

- PostgreSQL connection options now automatically escaped (prevents injection)
- SQLite extension loading marked as `unsafe`
- `SqliteValue` types now implement `!Sync` and `!Send` bounds

### Version 0.8.1

- Fixed RUSTSEC-2024-0363 (protocol truncation vulnerability)

## Recommendations

1. **Use version 0.8.6** - All known vulnerabilities are patched
2. **PostgreSQL users**: Ensure you are on >= 0.8.1 (critical)
3. **Input validation**: Always validate and limit input sizes
4. **Feature minimization**: Only enable needed database backends
5. **SQLite caution**: Be aware that SQLite feature uses unsafe code

## Risk Factors

| Factor                    | Assessment |
| ------------------------- | ---------- |
| Maintenance abandonment   | Low        |
| Supply chain compromise   | Low        |
| Unpatched vulnerabilities | None       |
| Dependency risk           | Medium     |
| Platform-specific issues  | Low        |

### Mitigating Factors

- High adoption (68M+ downloads) ensures rapid issue discovery
- Commercial backing from LaunchBadge
- Active maintainer with security-conscious approach
- Compile-time query checking reduces SQL injection risk at app level
- Forbids unsafe code by default (except SQLite FFI)

### Risk Notes

- **Dependency complexity**: Multiple sub-crates and database drivers increase
  audit surface
- **SQLite unsafe code**: FFI bindings to C library introduce unsafe code path
- **Protocol complexity**: Database wire protocols are security-sensitive

## Approval Status

- [x] APPROVED for use

**Conditions**: Use version >= 0.8.6 to ensure all security patches are
included. PostgreSQL users should be especially vigilant about using patched
versions.

---

## References

- [Crates.io](https://crates.io/crates/sqlx)
- [GitHub Repository](https://github.com/launchbadge/sqlx)
- [Documentation](https://docs.rs/sqlx)
- [RustSec Advisory Database](https://rustsec.org/packages/sqlx.html)
- [RUSTSEC-2024-0363](https://rustsec.org/advisories/RUSTSEC-2024-0363.html)
- [DEF CON 32 - SQL Injection at Protocol Level](https://www.wiz.io/vulnerability-database/cve/rustsec-2024-0363)
